#!/bin/bash

# ๐งน ุณูุฑูุจุช ุชูุธูู ูุฅุนุงุฏุฉ ุถุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช
# =============================================
# ูุฐุง ุงูุณูุฑูุจุช ูููู ุจู:
# 1. ุฃุฎุฐ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
# 2. ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
# 3. ุฅุถุงูุฉ ุงูุชุตูููุงุช ุงูุฃุณุงุณูุฉ (ุงุฎุชูุงุฑู)

# ุงูุฃููุงู ููุทุจุงุนุฉ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# ุนููุงู ุงูุณูุฑูุจุช
echo -e "${BLUE}"
echo "================================================"
echo "๐งน ุณูุฑูุจุช ุชูุธูู ูุฅุนุงุฏุฉ ุถุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช"
echo "================================================"
echo -e "${NC}"

# ุชุญุฐูุฑ
echo -e "${RED}โ๏ธ  ุชุญุฐูุฑ ูุงู โ๏ธ${NC}"
echo "ูุฐุง ุงูุณูุฑูุจุช ุณูููู ุจุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช!"
echo "ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐู ุงูุนูููุฉ."
echo ""
echo -e "${YELLOW}ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ [y/N]${NC}"
read -r response

if [[ ! "$response" =~ ^([yY][eE][sS]|[yY])$ ]]; then
    echo -e "${YELLOW}ุชู ุฅูุบุงุก ุงูุนูููุฉ.${NC}"
    exit 0
fi

# ุงูุฎุทูุฉ 1: ุงููุณุฎ ุงูุงุญุชูุงุทู
echo ""
echo -e "${BLUE}๐ฆ ุงูุฎุทูุฉ 1: ุฃุฎุฐ ูุณุฎุฉ ุงุญุชูุงุทูุฉ...${NC}"
echo -e "${YELLOW}ูู ุชุฑูุฏ ุฃุฎุฐ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุฃููุงูุ (ููุตุญ ุจุฐูู) [Y/n]${NC}"
read -r backup_response

if [[ ! "$backup_response" =~ ^([nN][oO]|[nN])$ ]]; then
    echo -e "${BLUE}ุฌุงุฑู ุฃุฎุฐ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...${NC}"
    node scripts/backup-before-clean.js
    
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}โ ุชูุช ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ${NC}"
    else
        echo -e "${RED}โ ูุดูุช ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ${NC}"
        echo -e "${YELLOW}ูู ุชุฑูุฏ ุงููุชุงุจุนุฉ ุจุฏูู ูุณุฎุฉ ุงุญุชูุงุทูุฉุ [y/N]${NC}"
        read -r continue_response
        if [[ ! "$continue_response" =~ ^([yY][eE][sS]|[yY])$ ]]; then
            echo -e "${YELLOW}ุชู ุฅูุบุงุก ุงูุนูููุฉ.${NC}"
            exit 1
        fi
    fi
else
    echo -e "${YELLOW}ุชู ุชุฎุทู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ${NC}"
fi

# ุงูุฎุทูุฉ 2: ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo ""
echo -e "${BLUE}๐งน ุงูุฎุทูุฉ 2: ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช...${NC}"
echo -e "${RED}ุณูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุงูุขู!${NC}"
echo ""

node scripts/clean-database-full.js

if [ $? -eq 0 ]; then
    echo -e "${GREEN}โ ุชู ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ${NC}"
else
    echo -e "${RED}โ ูุดู ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช${NC}"
    exit 1
fi

# ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (ุงุฎุชูุงุฑู)
echo ""
echo -e "${BLUE}๐ ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ${NC}"
echo -e "${YELLOW}ูู ุชุฑูุฏ ุฅุถุงูุฉ ุงูุชุตูููุงุช ุงูุฃุณุงุณูุฉุ [y/N]${NC}"
read -r categories_response

if [[ "$categories_response" =~ ^([yY][eE][sS]|[yY])$ ]]; then
    echo -e "${BLUE}ุฌุงุฑู ุฅุถุงูุฉ ุงูุชุตูููุงุช...${NC}"
    
    # ุงูุชุญูู ูู ูุฌูุฏ ุณูุฑูุจุช ุงูุชุตูููุงุช
    if [ -f "scripts/add-real-categories.js" ]; then
        node scripts/add-real-categories.js
        if [ $? -eq 0 ]; then
            echo -e "${GREEN}โ ุชูุช ุฅุถุงูุฉ ุงูุชุตูููุงุช ุจูุฌุงุญ${NC}"
        else
            echo -e "${RED}โ ูุดู ุฅุถุงูุฉ ุงูุชุตูููุงุช${NC}"
        fi
    else
        echo -e "${YELLOW}ูู ูุชู ุงูุนุซูุฑ ุนูู ุณูุฑูุจุช ุงูุชุตูููุงุช${NC}"
    fi
else
    echo -e "${YELLOW}ุชู ุชุฎุทู ุฅุถุงูุฉ ุงูุชุตูููุงุช${NC}"
fi

# ุงูููุฎุต ุงูููุงุฆู
echo ""
echo -e "${GREEN}================================================${NC}"
echo -e "${GREEN}โจ ุชูุช ุงูุนูููุฉ ุจูุฌุงุญ!${NC}"
echo -e "${GREEN}================================================${NC}"
echo ""
echo -e "${BLUE}ุงูุฎุทูุงุช ุงูุชุงููุฉ:${NC}"
echo "1. ุฅุถุงูุฉ ุงููุคูููู ูุงููุฑุงุณููู ุงูุญูููููู"
echo "2. ุฅุถุงูุฉ ุงููุญุชูู ุงูุฑุณูู ูู ุฅุฏุงุฑุฉ ุงูุตุญููุฉ"
echo "3. ุชูููู ุฅุนุฏุงุฏุงุช ุงููุธุงู ุญุณุจ ุงุญุชูุงุฌุงุช ุงูุตุญููุฉ"
echo ""
echo -e "${YELLOW}ููุงุญุธุฉ: ุชู ุงูุงุญุชูุงุธ ุจุงููุณุชุฎุฏููู ุงูุฅุฏุงุฑููู ููุท${NC}" 