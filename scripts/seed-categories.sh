#!/bin/bash

echo "==============================================="
echo "๐ฑ Sabq AI CMS - ูุธุงู ุฅุถุงูุฉ ุงูุชุตูููุงุช ุงูุฃุณุงุณูุฉ"
echo "==============================================="
echo ""

# ุงูุชุญูู ูู ูุฌูุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ
if [ ! -f .env ]; then
    echo "โ ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ููู .env"
    echo "   ูุฑุฌู ุงูุชุฃูุฏ ูู ูุฌูุฏ ููู .env ูุน ุจูุงูุงุช ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช"
    exit 1
fi

# ุงูุชุญูู ูู ูุฌูุฏ NODE_ENV
if [ -z "$NODE_ENV" ]; then
    echo "โ๏ธ  ุชุญุฐูุฑ: NODE_ENV ุบูุฑ ูุญุฏุฏุ ุณูุชู ุงุณุชุฎุฏุงู 'production'"
    export NODE_ENV=production
fi

echo "๐ ูุนูููุงุช ุงูุจูุฆุฉ:"
echo "   โข ุงูุจูุฆุฉ: $NODE_ENV"
echo "   โข ูุงุนุฏุฉ ุงูุจูุงูุงุช: PlanetScale"
echo ""

# ุงูุชุญูู ูู ุงูุชุซุจูุชุงุช
echo "๐ ุงูุชุญูู ูู ุงูุชุซุจูุชุงุช..."
if ! command -v node &> /dev/null; then
    echo "โ ุฎุทุฃ: Node.js ุบูุฑ ูุซุจุช"
    exit 1
fi

if ! command -v npm &> /dev/null; then
    echo "โ ุฎุทุฃ: npm ุบูุฑ ูุซุจุช"
    exit 1
fi

echo "   โ Node.js: $(node --version)"
echo "   โ npm: $(npm --version)"
echo ""

# ุชุฃููุฏ ูู ุงููุณุชุฎุฏู
echo "โ๏ธ  ุชุญุฐูุฑ: ุณูุชู ุชูููุฐ ุงูุนูููุงุช ุงูุชุงููุฉ:"
echo "   1. ุฅุถุงูุฉ/ุชุญุฏูุซ 8 ุชุตูููุงุช ุฃุณุงุณูุฉ"
echo "   2. ุฅูุดุงุก ุญุณุงุจุงุช ุฅุฏุงุฑูุฉ ุฃุณุงุณูุฉ (ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ)"
echo ""
echo "๐ ุงูุชุตูููุงุช ุงูุชู ุณูุชู ุฅุถุงูุชูุง:"
echo "   โข ุชูููุฉ (technology)"
echo "   โข ุฑูุงุถุฉ (sports)"
echo "   โข ุงูุชุตุงุฏ (economy)"
echo "   โข ุณูุงุณุฉ (politics)"
echo "   โข ูุญููุงุช (local)"
echo "   โข ุซูุงูุฉ ููุฌุชูุน (culture)"
echo "   โข ููุงูุงุช ุฑุฃู (opinion)"
echo "   โข ูููุนุงุช (misc)"
echo ""

read -p "ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ (y/N) " -n 1 -r
echo ""
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "โ ุชู ุฅูุบุงุก ุงูุนูููุฉ"
    exit 1
fi

# ุชูููุฏ Prisma Client
echo ""
echo "๐ง ุชูููุฏ Prisma Client..."
npm run prisma:generate
if [ $? -ne 0 ]; then
    echo "โ ูุดู ุชูููุฏ Prisma Client"
    exit 1
fi

# ุชุดุบูู Seed
echo ""
echo "๐ฑ ุชุดุบูู ุนูููุฉ Seed..."
npm run prisma:seed
if [ $? -ne 0 ]; then
    echo "โ ูุดู ุชุดุบูู ุนูููุฉ Seed"
    exit 1
fi

echo ""
echo "==============================================="
echo "โ ุชูุช ุนูููุฉ ุฅุถุงูุฉ ุงูุชุตูููุงุช ุจูุฌุงุญ!"
echo "==============================================="
echo ""
echo "๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo "   1. ุชุญูู ูู ุงูุชุตูููุงุช ูู ููุญุฉ ุงูุชุญูู"
echo "   2. ูู ุจุชุบููุฑ ูููุงุช ุงููุฑูุฑ ุงูุงูุชุฑุงุถูุฉ ููุญุณุงุจุงุช ุงูุฅุฏุงุฑูุฉ"
echo "   3. ุชุฃูุฏ ูู ุธููุฑ ุงูุชุตูููุงุช ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ"
echo ""
echo "๐ก ูุตูุญุฉ: ููููู ุชุดุบูู 'npm run prisma:studio' ูุนุฑุถ ุงูุจูุงูุงุช"
echo "" 